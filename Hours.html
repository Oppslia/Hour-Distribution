<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hour Distribution</title>
    <style>
        body {
            font-family: Euclid Circular A, Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        div .app-header {
            display:flex;
            flex-direction: row;
        }

        div.app-header svg#ps-logo {
            max-width: 30%;
            height: auto;
        }

        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: auto;
        }

        .container h1#header {
            margin-top: 0px !important;
        }

        .form-group {
            max-width: 200px;
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
            width: 100%;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #c5c5c5;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-family: inherit;
        }

        button#addProjectBtn {
            font-size: 20pt;
            max-height: 38px;
            display: flex; 
            justify-content: center;
            line-height: 16px;
            max-width:  38px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .added-field {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .added-field input {
            flex-grow: 1;
        }

        .summary-section {
            /* display:flex; */
            flex-direction: row;
            align-items: start;
            padding-top: 10px;
            padding-bottom: 10px;
            border-top: 1px solid #eee;
        }

        .summary-section h2 {
            margin-top: 0;
            color: #333;
        }

        .summary-section p {
            margin-bottom: 5px;
        }

        .summary-section strong {
            color: #007bff;
        }

        .chart-section {
            width: 100%
        }
        
        .project-section {
            width: 100%;
        }

        
       .edit-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .edit-project-name-container {
            flex: 1 1 150px;
            min-width: 150px;
        }

        .edit-projectHours {
            padding: .5em 1em;
            width: auto;
            max-width: 85px;
            height: 38px;
            box-sizing: border-box;
            border: 1px solid #c5c5c5;
            border-radius: 4px;
            margin-right: auto;
        }

        .edit-projectName {
            padding: .5em 1em;
            width: 100%;
            height: 38px;
            box-sizing: border-box;
            border: 1px solid #c5c5c5;
            border-radius: 4px;
        }

        .edit-button-container, .edit-input-container {
            display: flex;
            flex-direction: row;
            gap: 10px;
            width: auto;
        }

        .edit-input-container input {
            padding: .5em 1em;
            width: auto;
            max-width: 75px;
            height: 38px;
            box-sizing: border-box;
            border: 1px solid #c5c5c5;
            border-radius: 4px;
        }

        .edit-button-container button {
            width: auto;
            max-width: 200px;
        }

        .project-input-group {
            display:flex;
            flex-wrap:  wrap;
            flex-direction: row;
            gap: 10px;
            margin-bottom: 15px;
            max-width: 400px;

        }

        .project-input-group input {
            padding: .5em 1em;
            width: 100%;
            max-width: 100%;
            height: 38px;
            box-sizing: border-box;
            border: 1px solid #c5c5c5;
            border-radius: 4px;
        }

        .project-input-group input:not(#projectName) {
            max-width: 85px;
        }

        .project-name-container, .hours-field-submit-button-container {
            display: flex;
            gap: 10px;
        }

        .project-name-container {
            width: 100%;
            max-width: 200px;
        }

        .project-list:has(.editing) li:not(.editing) {
            width:auto;
            
        }

        .project-list li.editing {
            justify-content: flex-start;
            max-width: 70%;
            min-width: 191.09px;
            border-style: dotted;
            border-width: 3px;
            border-color: #007bffb6; 
            padding: 8px 12px;
            
        }
        
        .project-list {
            list-style: none;
            padding: 0;
            width: 100%;
            overflow-y: auto;
        }

        .project-list li {
                box-sizing: border-box;
                width: 100%;
                min-width: 225px;
                background-color: #e9ecef;
                border-style: solid;
                border-width: 3px;
                border-color: #007bff67;
                padding: 8px 0;
                margin-bottom: 5px;
                border-radius: 4px;
                display: flex;
                justify-content: flex-start;
                align-items: center;
                gap: 10px;
        }

        .project-list li span.project-card-name {
            font-weight: bold;
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding-left: 10px;
        }

        .project-list li span.project-card-hrs {
            flex-shrink: 0;
            white-space: nowrap;
        }

        .project-list li span.project-card-group {
            margin-left: auto;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-shrink: 0;
            border-radius: 4px 0 0 4px;
            padding-right: 10px;
        }
        .project-list li span.project-card-percent {
            margin-right: 10px;
            white-space: nowrap;
            padding-top: 8px; 
            padding-bottom: 8px;
            padding-left: 10px;
        }
        
        .project-list li span.project-card-edit {
            height:38px;
        }

        .project-list li span.project-card-edit button {
            padding: .35em;
        }

        .project-list li span:last-child {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }

        .chart-container canvas{
            max-width: 300px;
            max-height: 300px;
        }
        
        .button-group {
            display:flex;
            flex-wrap: wrap;
            gap: 10px;
            border-top:1px solid #eee;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        .project-list li.editing .delete {
            margin-left: auto;
            min-width: 80px;
        }

        .project-list li.editing .cancel {
            min-width: 85px;
            margin-right: auto;
        }

        .project-list li.editing .save {
            min-width: 80px;
        }
        
    </style>
</head>
<body>
    <div id='app' class="container resizable">
        <div class="resize-handle"></div>
        <div class="app-header">
        <date-display></date-display>
        <svg id="ps-logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 164.85 30.63">
            <defs>
                <style>.cls-1{fill:#fff;}.cls-1,.cls-2{fill-rule:evenodd;}.cls-2{fill:#0f3873;}.cls-3{mask:url(#mask);}.cls-4{mask:url(#mask-2-2);}</style>
                <mask id="mask" x="0" y="0" width="30.38" height="30.63" maskUnits="userSpaceOnUse">
                    <g id="mask-2">
                        <polygon id="path-1" class="cls-1" points="0 0 30.38 0 30.38 30.63 0 30.63 0 0"></polygon>
                    </g>
                </mask>
                <mask id="mask-2-2" x="0" y="0" width="164.85" height="30.63" maskUnits="userSpaceOnUse">
                    <g id="mask-4">
                        <polygon id="path-3" class="cls-1" points="0 30.63 164.85 30.63 164.85 0 0 0 0 30.63"></polygon>
                    </g>
                </mask>
            </defs>
            <g id="Layer_2" data-name="Layer 2">
                <g id="Layer_1-2" data-name="Layer 1">
                    <g id="Page-1">
                        <g id="Main-Home">
                        <g id="Group-26">
                            <path id="Fill-1" class="cls-2" d="M18.1,7.88l-.4,3.53a.29.29,0,0,0,.08.23l3.93,4.23a.29.29,0,0,1,0,.4l-4.62,4.37a.37.37,0,0,0-.08.18l-.41,3.55a.25.25,0,0,0,.41.24l9-8.34a.29.29,0,0,0,0-.4L18.52,7.72a.24.24,0,0,0-.42.16"></path>
                            <g id="Group-5">
                                <g class="cls-3">
                                    <path id="Fill-3" class="cls-2" d="M2.78,16.44a14,14,0,0,1,27.38-3.92.11.11,0,1,0,.21,0A15.32,15.32,0,1,0,13.44,30.53c.19-1-.15.81,0-.22A14,14,0,0,1,2.78,16.44"></path>
                                </g>
                            </g>
                            <path id="Fill-6" class="cls-2" d="M9.71,20.64a.31.31,0,0,0-.09.18l-.4,3.55a.25.25,0,0,0,.4.24l7.5-6.94H12.84Z"></path>
                            <path id="Fill-8" class="cls-2" d="M11.14,7.72a.24.24,0,0,0-.42.16l-.39,3.53a.28.28,0,0,0,.07.23l2.79,3h4.33Z"></path>
                            <path id="Fill-10" class="cls-2" d="M41.63,14.38c1.51,0,2.32-.71,2.32-2.06v-.09c0-1.4-.83-2-2.3-2H40.28v4.13Zm-6-7.66h6.24c4.49,0,6.58,2,6.58,5.48v.09c0,3.44-2.32,5.3-6.38,5.3H40.28v5.53H35.6Z"></path>
                            <path id="Fill-12" class="cls-2" d="M48.65,17.91h4.47c.11,1.17.64,2.14,2.59,2.14,1.35,0,2.11-.67,2.11-1.63s-.62-1.29-2.59-1.58C50.6,16.28,49,14.91,49,11.61c0-3,2.43-5.12,6.35-5.12s6.17,1.65,6.47,5.12H57.5a1.87,1.87,0,0,0-2.11-1.77c-1.26,0-1.9.57-1.9,1.4S54,12.57,56,12.85c4.15.45,6.29,1.53,6.29,5.09,0,3-2.39,5.45-6.61,5.45-4.59,0-6.92-1.92-7.06-5.48"></path>
                            <path id="Fill-14" class="cls-2" d="M66.31,17.91h4.47c.11,1.17.64,2.14,2.59,2.14,1.35,0,2.11-.67,2.11-1.63s-.62-1.29-2.59-1.58c-4.64-.56-6.19-1.93-6.19-5.23,0-3,2.43-5.12,6.35-5.12s6.17,1.65,6.46,5.12H75.16a1.87,1.87,0,0,0-2.11-1.77c-1.26,0-1.91.57-1.91,1.4s.51,1.33,2.55,1.61c4.15.45,6.28,1.53,6.28,5.09,0,3-2.38,5.45-6.6,5.45-4.59,0-6.93-1.92-7.06-5.48"></path>
                            <path id="Fill-16" class="cls-2" d="M89.4,17.2V17c0-2-.8-3.14-2.36-3.14S84.65,15,84.65,17v.19c0,2.06.8,3.18,2.39,3.18S89.4,19.2,89.4,17.2m-9,.07v-.18c0-3.86,2.87-6.29,6.59-6.29s6.53,2.37,6.53,6.17v.19c0,3.9-2.86,6.23-6.56,6.23s-6.56-2.24-6.56-6.12"></path>
                            <g class="cls-4">
                                <polygon id="Fill-18" class="cls-2" points="94.63 23.12 98.71 23.12 98.71 5.85 94.63 5.85 94.63 23.12"></polygon>
                            </g>
                            <g class="cls-4">
                                <path id="Fill-20" class="cls-2" d="M100.31,18.94V11.12h4.11v7.16c0,1.35.53,2,1.7,2s2-.74,2-2.27V11.12h4.1v12h-4.1V21.26a4,4,0,0,1-3.81,2.13c-2.32,0-4-1.42-4-4.45"></path>
                            </g>
                            <g class="cls-4">
                                <path id="Fill-21" class="cls-2" d="M114.39,19.27V13.92H113v-2.8h1.44V8.63h4.11v2.49h2.36v2.8H118.5v5a1.09,1.09,0,0,0,1.21,1.26,3.05,3.05,0,0,0,1.17-.21v3.12a8.44,8.44,0,0,1-2.27.34c-2.7,0-4.22-1.3-4.22-4.12"></path>
                            </g>
                            <g class="cls-4">
                                <path id="Fill-22" class="cls-2" d="M122,23.12h4.11v-12H122Zm-.21-15.25A2.27,2.27,0,1,1,124.07,10a2.14,2.14,0,0,1-2.25-2.11Z"></path>
                            </g>
                            <g class="cls-4">
                                <path id="Fill-23" class="cls-2" d="M136.13,17.2V17c0-2-.8-3.14-2.36-3.14S131.39,15,131.39,17v.19c0,2.06.8,3.18,2.38,3.18s2.36-1.14,2.36-3.14m-8.94.07v-.18c0-3.86,2.87-6.29,6.58-6.29s6.54,2.37,6.54,6.17v.19c0,3.9-2.87,6.23-6.56,6.23s-6.56-2.24-6.56-6.12"></path>
                            </g>
                            <g class="cls-4">
                                <path id="Fill-24" class="cls-2" d="M141.25,11.12h4.1v1.93a4.24,4.24,0,0,1,4-2.25c2.31,0,3.92,1.45,3.92,4.52v7.8h-4.11v-7c0-1.36-.52-2-1.72-2s-2,.73-2,2.27v6.72h-4.1Z"></path>
                            </g>
                            <g class="cls-4">
                                <path id="Fill-25" class="cls-2" d="M153.91,19.31h3.78c.14.87.53,1.36,1.7,1.36,1,0,1.47-.39,1.47-1s-.58-.85-2.23-1.08c-3.21-.41-4.56-1.35-4.56-3.85,0-2.66,2.36-3.95,5.14-3.95,2.95,0,5,1,5.29,3.88h-3.71a1.34,1.34,0,0,0-1.54-1.19c-.89,0-1.35.39-1.35.94s.55.8,2,1c3.32.42,4.93,1.29,4.93,3.86,0,2.84-2.11,4.12-5.44,4.12S154,22,153.91,19.31"></path>
                            </g>
                        </g>
                        </g>
                    </g>
                </g>
            </g>
        </svg> 
        </div>
        <h1 id="header">Project Hours</h1>
        <div class="form-group">
            <label for="totalHours">Total Available Hours:</label>
            <input type="number" id="totalHours" name="totalHours" placeholder="Enter total hours" min="0" value="40">
        </div>

        <h3>Add Project:</h3>
        <div class="project-input-group">
            <div class="project-name-container">
                <input type="text" id="projectName" placeholder="Project Name">
            </div>
            <div class="hours-field-submit-button-container">
                <input type="number" id="projectHours" placeholder="Hours" min="0">
                <button id="addProjectBtn">+</button>
            </div>
        </div>
        <div class="project-section">
                    <h3>Projects:</h3>
                    <ul id="projectList" class="project-list"></ul>
                </div>
        <div class="summary-section">
            <div class="summary">
                <h2>Summary</h2>
                <p>Total Available Hours: <strong id="summaryTotalHours">0</strong></p>
                <p>Allocated Hours: <strong id="summaryAllocatedHours">0</strong></p>
                <p>Remaining Hours: <strong id="summaryRemainingHours">0</strong></p>
                
            </div>
        </div>
        <div class="chart-section">
            <div class="button-group">
                <button id="pieBtn">Pie Chart</button>
                <button id="barBtn">Bar Chart</button>
                <button id="seed">Seed</button>
            </div>
            <div class="chart-container">
                <canvas width="280px" height="280px" id="chartDisplay"></canvas>
            </div>
        </div>
    <div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.cdnfonts.com/css/euclid-circular-a" rel="stylesheet">
    </div>
    <style>
    .resizable {
        position: relative;
        min-height: fit-content;
        border: 1px solid #ccc;
        padding: 20px;
        min-width: 293px;
    }
        
    .resize-handle {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 15px;
        height: 15px;
        border-width: 3px;
        border-style: solid;
        border-color:#007bff;
        border-radius: 3px 0px 0px 0px;
        background-color: hsla(211, 77%, 79%, 0.322);
        background-image: url('https://cdn4.iconfinder.com/data/icons/materia-flat-arrows-symbols-vol-1/24/018_035_arrow_resize_window-512.png');
        background-repeat: no-repeat;
        background-size: contain;
        background-position: center;
        cursor: se-resize;
    }
    @media (max-width: 768px) {
        .resize-handle {
            display:none
        }
    }
    </style>
    <script type="module">
        /**
         * @property {string} projectName
         * @property {number} projectHours
         * @property {string} id
        */
        class Project {
            /**
             * @param {string} name
             * @param {number} hours
             * @returns {void}
             */
            constructor(projectName, projectHours) {
                this.name = projectName;
                this.hours = projectHours;
                this.id = crypto.randomUUID ? crypto.randomUUID() : this.__uuidv4();
            }

            /**
             * @returns {string}
             */
            __uuidv4() {
                console.log("Insecure Browser. Generating Local UUID");
                return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
                    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
                );
            }
        }

        class DateDisplay extends HTMLElement {
            constructor() {
                super();
                this._week = this.getWeek()
                this.textContent = `Week Of: ${this._week.start} - ${this._week.end}`;
                this.style.fontSize = ".70em";
                this.style.fontFamily = "Euclid Circular A, sans-serif";
                this.style.alignSelf = "end";
                this.style.flex = 1;
            }
            
            getWeek(date=new Date()) {
                const start = new Date(date);
                start.setDate(date.getDate() - date.getDay());
                const end = new Date(date);
                end.setDate(date.getDate() + (6 - date.getDay()));
                const options = { month: 'short', day: 'numeric', year: 'numeric' };
                return {
                    start: start.toLocaleDateString('en-US', options),
                    end: end.toLocaleDateString('en-US', options)
                };
            }
        }

        class Observer{
            /**
             * @param {any} data - The data payload sent by the Subject.
             * @returns {void}
             */
            update(data) {
                throw new Error('Observer.update() must be implemented by concrete subclasses.');
            }
        }

        class Subject {
            constructor() {
                this._observers = []; 
            }

            /**
             * Allows an Observer to subscribe to data changes.
             * @param {Observer} observer - An instance of a class extending Observer.
             * @returns {void}
             */
            subscribe(observer) {
                if (observer instanceof Observer) {
                    this._observers.push(observer);
                } else {
                    console.error("Subscription failed: Object must be an instance of Observer.");
                }
            }
            
            /**
             * Notifies all subscribed Observers of a change.
             * @param {any} data - The data payload to send to observers.
             * @returns {void}
             */

            notifyObservers(data) {
                console.log(data)
                this._observers.forEach(observer => {
                    try {
                        observer.update(data);
                    } catch (e) {
                        console.error(`Error notifying observer: ${e.message}`);
                    }
                }); 
            }
        }

        class ProjectManager extends Subject {
            /**
            * @returns {void}
             */
            constructor(){
                super();
                this._projects = [];
                this._editing = false;
                this._totalHoursInput = document.getElementById('totalHours');
                this._projectNameInput = document.getElementById('projectName');
                this._projectHoursInput = document.getElementById('projectHours');
                this._addProjectBtn = document.getElementById('addProjectBtn');
                this._totalAvailableHours = Number(this._totalHoursInput.value);
                this._totalHoursInput.min = Number(this._totalHoursInput.value);
                [this._projectNameInput, this._projectHoursInput].forEach(input => {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' ) {
                            this._addProjectBtn.click();
                        }
                    });
                });
                this._totalHoursInput.addEventListener('focusout', (event) => {
                    const newTotalHours = Number(event.target.value);
                    console.log(this._totalAvailableHours, newTotalHours)
                    if(this._totalAvailableHours == newTotalHours) {
                        return
                    }

                    const minHoursByExistingProjects = this._projects.reduce((acc, current) => acc + current.hours, 0);
                    console.log(minHoursByExistingProjects);
                    if (newTotalHours < minHoursByExistingProjects) {
                        this._totalHoursInput.value = minHoursByExistingProjects;
                        alert("Total hours cannot be lower than the currently allocated projects.")
                    } else {
                        this._totalHoursInput.min = newTotalHours;
                        this._totalAvailableHours = this._totalHoursInput.value;
                        this.updateSummary();
                    }

                });
                this._totalHoursInput.addEventListener('keyup', (event) => {
                    console.log(event.key)
                    if (event.key === 'Enter') {
                        const newTotalHours = Number(event.target.value);
                        if(this._totalAvailableHours == newTotalHours) {
                            return
                        }

                        const minHoursByExistingProjects = this._projects.reduce((acc, current) => acc + current.hours, 0);
                        if (newTotalHours < minHoursByExistingProjects) {
                            this._totalHoursInput.value = minHoursByExistingProjects;
                            alert("Total hours cannot be lower than the currently allocated projects.")
                        } else {
                            this._totalHoursInput.min = newTotalHours;
                            this._totalAvailableHours = this._totalHoursInput.value;
                            this.updateSummary();
                        }
                    }
                });
                this._addProjectBtn.addEventListener('click', () => {
                    /** @type {string} */
                    const projectName = this._projectNameInput.value.trim();

                    /** @type {number} */
                    const projectHours = Number(this._projectHoursInput.value);
                    
                    if (this.createProject(projectName, projectHours)) {
                        this._projectNameInput.value = '';
                        this._projectHoursInput.value = '';
                        return;
                    } 
                });
            }
            
            /**
             * @param {string} projectName
             * @param {number} projectHours
             * @returns {boolean}
             */
            validateInput(projectName, projectHours) {
                projectHours = Number(projectHours);
                projectName.trim();
                const projectExists = this._projects.some(p => p.name.toLowerCase() === projectName.toLowerCase())
                if(projectExists && !this._editing){
                    alert('Project already exists');
                    return false;
                }

                if (!projectName.length > 0){
                    alert('Please enter a project name');
                    return false;
                }

                if (!projectHours > 0 || isNaN(projectHours)){
                    alert('Please enter project hours');
                    return false;
                }

                if (projectHours % 0.25 !== 0) {
                    alert('Hours may only have decimals in quarter intervals.');
                    return false;
                }

                if ((this._projects
                    .reduce((accumulator, currentValue) => {
                        return accumulator + currentValue.hours
                        }, 0) + projectHours) > Number(this._totalHoursInput.value)) {
                    alert('Hours entered is greater than total allocated hours.');
                    return false;
                }
                 
                if (projectName.length > 0 && !isNaN(projectHours) && projectHours >= 0) {
                    return true;
                }
            }
            /**
             * @param {string} projectName
             * @param {number} projectHours
             * @returns {void}
             */
            createProject(projectName, projectHours) {
                if (this.validateInput(projectName, projectHours)) {
                    this._projects.push(new Project(projectName, projectHours));
                    this.updateSummary()
                }
            }
            /**
             * @param {str} projectId
             * @returns {void}
             */
            editProject(projectId) {
                const project = this._projects.find(p => p.id === projectId);

                if (!project) {
                    console.error(`Project with ID ${projectId} not found.`);
                    return;
                }
                this._editing = true;
                this._totalHoursInput.readOnly = true;
                const listItem = document.getElementById(`project-${project.id}`);
                listItem.classList.add("editing");
                listItem.innerHTML = `
                    <div class="edit-group">
                        <div class="edit-project-name-container">
                            <input type="text" class="edit-projectName" id="edit-name-${project.id}" value="${project.name}">
                        </div>
                        <input type="number" class="edit-projectHours" id="edit-hours-${project.id}" value="${project.hours.toFixed(2)}">
                        <button class="save">Save</button>
                        <button class="cancel">Cancel</button>
                        <button class="delete">Delete</button>
                    </div>
                `;

                listItem.querySelector('.save').addEventListener('click', () => {
                    const projectNameElement = document.getElementById(`edit-name-${project.id}`);
                    const projectHoursElement = document.getElementById(`edit-hours-${project.id}`);
                    const originalHours = project.hours;
                    project.hours = 0; // Sets it to 0 so that it's not calculated in the validation
                    if(this.validateInput(projectNameElement.value, Number(projectHoursElement.value))) {
                        project.name = projectNameElement.value;
                        project.hours = Number(projectHoursElement.value);
                        this._editing=false;
                        this._totalHoursInput.readOnly = false;
                        this.updateSummary();
                    } else { 
                        project.hours = originalHours;
                    }
                });
                
                listItem.querySelector('.delete').addEventListener('click', () => {
                    this._projects.splice(this._projects.indexOf(p => p.id == project.id), 1);
                    this._editing=false;
                    this._totalHoursInput.readOnly = false;
                    this.updateSummary();
                })

                listItem.querySelector('.cancel').addEventListener('click', () => {
                    this._editing=false;
                    this._totalHoursInput.readOnly = false;
                    this.updateSummary()
                });

            }
            /**
             * @returns {void}
             */
            updateSummary() {
                const summaryTotalHours = document.getElementById('summaryTotalHours');
                const summaryAllocatedHours = document.getElementById('summaryAllocatedHours');
                const summaryRemainingHours = document.getElementById('summaryRemainingHours');
                const projectList = document.getElementById('projectList');
                /**@type {number}*/
                const totalHours = Number(this._totalHoursInput.value) || 0;
                /**@type {number}*/
                
                const allocatedHours = this._projects
                    .reduce((accumulator, currentValue) => {
                        return accumulator + currentValue.hours
                        }, 0);
                 /**@type {number} */
                const remainingHours = totalHours - allocatedHours;

                summaryTotalHours.textContent = totalHours.toFixed(2);
                summaryAllocatedHours.textContent = allocatedHours.toFixed(2);
                summaryRemainingHours.textContent = remainingHours.toFixed(2);

                projectList.innerHTML = ''; // Clear existing list
                this._projects.forEach(project => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <span class="project-card-name">${project.name}:</span>
                        <span class="project-card-hrs">${project.hours.toFixed(2)} hrs</span>
                        <span class="project-card-group" id="project-card-group">
                            <span class="project-card-percent">${((project.hours / totalHours) * 100).toFixed(2)}%</span>
                            <span class="project-card-edit"><button id='project-edit-button'>Edit</button></span>
                        </span>`
                    listItem.querySelector('#project-edit-button').addEventListener('click', () => {
                        this.editProject(project.id);
                    });
                    listItem.querySelector('#project-card-group').style.backgroundColor = this.getColorByWeight(project.hours);
                    listItem.id = `project-${project.id}`;
                    projectList.appendChild(listItem);
                });
                if (projectList.children.length >= 4) {
                    projectList.style.maxHeight = projectList.offsetHeight + 'px'
                }

                
                this.notifyObservers(this._projects);
            }
            /**
             * @param {number} value
             * @returns {string}
             */
            getColorByWeight(value) {
                const percentage = (value / this._totalHoursInput.value) * 100;
                
                // Base color: #007bff is hsl(211, 100%, 50%)
                const baseHue = 211; // Blue hue
                
                // Lightness goes from 95% (very light) to 55% (medium)
                const lightness = 95 - (percentage * 0.4);
                
                // Saturation goes from 20% to 50%
                const saturation = 20 + (percentage * 0.3);
                
                return `hsl(${baseHue}, ${saturation}%, ${lightness}%)`;
            }
        }
        
        class ChartManager extends Observer {
            /**
             * @param {string} canvasId
             * @returns {void}
            */
            constructor(canvasId) {
                super();
                this.chart = null;
                this.currentChartType = null;
                this.ctx = document.getElementById(canvasId).getContext('2d');
                this.projects = [];
                // this.projectManager = projectMananger
                document.getElementById('pieBtn').addEventListener('click', () => this.currentChartType != 'pie' ? this.switchChart('pie') : this.hideChart());
                document.getElementById('barBtn').addEventListener('click', () => this.currentChartType != 'bar' ? this.switchChart('bar') : this.hideChart());
                this.hideChart()
            }
            /**
             * @override
             * This method is called by the ProjectManager (Subject).
             * @param {Project[]} projects - The latest project data.
             * @returns {void}
             */
            update(projects) { 
                this.projects = projects;
                this.updateChart();
            }
            /**
             * @param {string} type
             * @returns {void}
             */
            createChart(type) {
                if (!this.projects || !this.projects.length > 0){
                    return;
                }
                
                else if (this.chart) {
                    this.chart.destroy();
                    this.chart = null;
                }

                this.showChart();
                this.currentChartType = type

                switch(type) {
                    case 'pie':
                        this.chart = new Chart(this.ctx, {
                            type: 'pie',
                            data: {
                                labels: this.projects.map(p => p.name),
                                datasets: [{
                                    label: 'Project Distribution',
                                    data: this.projects.map(p => p.hours),
                                    backgroundColor: this.projects.map(() => 
                                        `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`
                                    ),
                                    hoverOffset: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'right'
                                    }
                                }
                            }
                        });
                        break;
                    case 'bar':
                        this.chart = new Chart(this.ctx, {
                            type: 'bar',
                            data: {
                                labels: this.projects.map(p => p.name),
                                datasets: [{
                                    label: 'Project Distribution',
                                    data: this.projects.map(p => p.hours),
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: { beginAtZero: true }
                                }
                            }
                        });
                        break;
                }
            }
            /**
             * @returns {void}
             */
            updateChart() {
                if (!this.chart || !this.currentChartType) return;
                if (!this.projects.length > 0) {
                    this.hideChart();
                    this.currentChartType = null;
                }

                switch(this.currentChartType) {
                    case 'pie':
                        this.chart.data.labels = this.projects.map(p => p.name);
                        this.chart.data.datasets[0].data = this.projects.map(p => p.hours);
                        this.chart.data.datasets[0].backgroundColor = this.projects.map(() => 
                            `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`
                        );
                        this.chart.update();
                        break;
                    case 'bar':
                        this.chart.data.labels = this.projects.map(p => p.name);
                        this.chart.data.datasets[0].data = this.projects.map(p => p.hours);
                        this.chart.update();
                        break;
                }
            }
            /**
             * @param {string} type
             * @returns {void}
             */
            switchChart(type) {;
                this.createChart(type);
                document.getElementById('pieBtn').classList.toggle('active', type === 'pie');
                document.getElementById('barBtn').classList.toggle('active', type === 'bar');
            }
            /**
             * @returns {void}
             */
            hideChart() {
                if (this.chart) {
                    this.chart.destroy();
                    this.chart = null;
                    this.currentChartType = null;
                }
                
                const chartContainer = document.querySelector('.chart-container');
                const buttonGroup = document.querySelector('.button-group');
                if (buttonGroup) {
                    buttonGroup.querySelectorAll('button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                }
                if (chartContainer) {
                    chartContainer.style.display = 'none';
                }
            }
            /**
             * @returns {void}
             */
            showChart() {
                const chartContainer = document.querySelector('.chart-container');
                if (chartContainer) {
                    chartContainer.style.display = 'block';
                }
            }
        }

        class DragWindow {
            constructor() {
                this.resizeHandleElement = document.querySelector('.resize-handle');
                this.resizableElement = document.querySelector('.resizable');

                this.isDragging = false;

                this.resizeHandleElement.addEventListener('mousedown', (e) => {
                    e.preventDefault(); // stop text selection
                    this.isDragging = true;
                    this.startX = e.clientX;
                    this.startY = e.clientY;
                    this.startWidth = parseInt(getComputedStyle(this.resizableElement).width, 10);
                    this.startHeight = parseInt(getComputedStyle(this.resizableElement).height, 10);
              
                });

                document.addEventListener('mousemove', (e) => {
                    if (this.isDragging) {
                        const dx = e.clientX - this.startX;
                        const dy = e.clientY - this.startY;
                        this.resizableElement.style.width = (this.startWidth + dx) + 'px';
                        this.resizableElement.style.height = (this.startHeight + dy) + 'px';
                    }
                });

                document.addEventListener('mouseup', () => {
                    this.isDragging = false;
                  
                });
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            customElements.define('date-display', DateDisplay)
            const projectManager = new ProjectManager()
            const chartManager = new ChartManager('chartDisplay');
            projectManager.subscribe(chartManager);
            const seedButton = document.getElementById('seed');
            const dragWindow = new DragWindow();
            seed.addEventListener('click', function() {
                    projectManager.createProject('Arc-Transit', 10);
                    projectManager.createProject('APS', 10);
                    projectManager.createProject('Culture-Index', 20);
                    this.remove();
            })
        });
    </script>
</body>
</html>